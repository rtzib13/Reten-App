{% extends "base.html" %}
{% load tz %}
{% block content %}

<div class="card">
  <h2 class="page-title" style="margin-bottom:6px;">{{ report.title }}</h2>

  <div class="row" style="margin-bottom:10px;">
    <span class="meta">ğŸ•’ {{ report.created_at|localtime|timesince }} ago ({{ report.created_at|localtime|date:"g:i A" }})</span>

    <span class="badge badge-{{ report.severity|lower }}">
      {{ report.get_severity_display }}
    </span>

    <span class="badge {% if report.status == 'ACTIVE' %}badge-active{% else %}badge-resolved{% endif %}">
      {{ report.status }}
    </span>

    {% if report.verified %}
      <span class="badge badge-admin">âœ… Admin Verified</span>
    {% elif report.owner.profile.is_verified %}
      <span class="badge badge-acc">âœ… Verified Account</span>
    {% else %}
      <span class="badge badge-unv">âš ï¸ Unverified</span>
    {% endif %}
  </div>

  <div class="row" style="margin-bottom:6px;">
    <span class="meta">ğŸ“ {{ report.city }}, {{ report.state }}</span>
    <span class="meta">ğŸ›£ {{ report.road_name }}</span>

    {% if report.nearby_place %}
    <span class="meta">ğŸ“Œ Near: {{ report.nearby_place }}</span>
  {% endif %}
  </div>

  <div class="hr"></div>

  <p style="margin:0 0 12px;">
    <strong>Description:</strong><br>
    {{ report.description }}
  </p>

  <div class="row" style="justify-content: space-between;">
    <span class="meta">ğŸ‘ {{ confirmation_count }} confirmations</span>

    {% if report.owner != user %}
      {% if not already_confirmed %}
        <a class="nav-pill" href="{% url 'report-confirm' report.id %}">Confirm</a>
      {% else %}
        <a class="nav-pill" href="{% url 'report-unconfirm' report.id %}">Unconfirm</a>
      {% endif %}
    {% else %}
      <span class="meta">You canâ€™t confirm your own report.</span>
    {% endif %}
  </div>

  {% if user == report.owner %}
    <div class="row" style="margin-top:12px;">
      <a class="nav-pill" href="{% url 'report-update' report.id %}">Edit</a>
      <a class="nav-pill" href="{% url 'report-delete' report.id %}">Delete</a>
    </div>
  {% endif %}
</div>

<div style="height:14px;"></div>

<div class="card">
  <h3 style="margin-bottom:12px;">Comments</h3>

  <div class="stack">
    {% for comment in report.comments.all %}
      <div class="card" style="box-shadow:none;">
        <div class="row" style="justify-content: space-between;">
          <div>
            <strong>{{ comment.owner.username }}</strong>
            <span class="meta">Â· {{ comment.created_at|localtime|date:"M d, Y Â· g:i A" }}</span>
          </div>

          {% if comment.owner == user %}
            <form method="post" action="{% url 'comment-delete' comment.id %}">
              {% csrf_token %}
              <button type="submit">Delete</button>
            </form>
          {% endif %}
        </div>

        <p style="margin:10px 0 0;">{{ comment.text }}</p>
      </div>
    {% empty %}
      <p class="meta">No comments yet.</p>
    {% endfor %}
  </div>

  <div class="hr"></div>

  <h3 style="margin-bottom:10px;">Add a comment</h3>
  <form method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Add Comment</button>
  </form>
</div>

{% endblock %}
