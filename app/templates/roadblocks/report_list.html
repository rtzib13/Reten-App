{% extends "base.html" %}
{% block content %}

<h2 class="page-title">Roadblock Reports</h2>

<div class="row" style="margin: 10px 0 18px;">
  <span class="badge badge-active">Active: {{ stats.active }}</span>
  <span class="badge badge-resolved">Resolved: {{ stats.resolved }}</span>
  <span class="badge badge-acc">Trusted: {{ stats.trusted }}</span>
  <span class="badge">Total: {{ stats.total }}</span>
</div>

{% if needs_location %}
  <div class="notice">
    You need to set your location to see nearby roadblocks.
    <a href="{% url 'edit-location' %}">Update location</a>
  </div>
{% endif %}

<div class="card form-card">
  <form method="get" class="filter-form">
    {{ filter_form.as_p }}
    <button type="submit">Filter</button>
  </form>
</div>

<div class="stack">
  {% for report in reports %}
    <div class="card">
      <div class="report-title">
        <a href="{% url 'report-detail' report.id %}">{{ report.title }}</a>
      </div>

      <div class="row">
        <span class="badge badge-{{ report.severity|lower }}">
          {{ report.get_severity_display }}
        </span>

        <span class="badge {% if report.status == 'ACTIVE' %}badge-active{% else %}badge-resolved{% endif %}">
          {{ report.status }}
        </span>

        <span class="meta">ğŸ“ {{ report.city }}, {{ report.state }}</span>
      </div>

      <div class="row" style="margin-top:10px;">
        <span class="meta">ğŸ•’ {{ report.created_at|date:"M d, Y Â· g:i A" }}</span>

        {% if report.verified %}
          <span class="badge badge-admin">âœ… Admin Verified</span>
        {% elif report.owner.profile.is_verified %}
          <span class="badge badge-acc">âœ… Verified Account</span>
        {% else %}
          <span class="badge badge-unv">âš ï¸ Unverified</span>
        {% endif %}

        <span class="meta">ğŸ‘ {{ report.confirmations.count }} confirmations</span>

        <a class="nav-pill" target="_blank"
            href="https://www.google.com/maps/search/?api=1&query={{ report.road_name|urlencode }}+{% if report.nearby_place %}near+{{ report.nearby_place|urlencode }}+{% endif %}{{ report.city|urlencode }}+{{ report.state|urlencode }}">
          View map
        </a>
      </div>
    </div>
  {% empty %}
    <div class="card">
      <p class="meta">No reports found.</p>
    </div>
  {% endfor %}
</div>

{% endblock %}
